<!DOCTYPE html>

  <html lang="en" class="">
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Blackbaud SKY API Developer Portal | Authorization Code Flow - C# .NET Core</title>
      <link rel="icon" href="/img/favicon.ico" type="image/ico">

      
        <link rel="stylesheet" href="https://sky.blackbaudcdn.net/skyux/1.9.2/css/sky-bundle.css">
<link rel="stylesheet" href="/css/app.css">
      
      

      
        <link rel="stylesheet" href="/assets/css/custom.css">
      

      


      <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->

      
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2418840-1', 'auto');
  ga('send', 'pageview');
</script>
      

    </head>
    <body data-base="/" class="bb-omnibar-height-padding ">

      
        <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-W56QP9"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-W56QP9');</script>
      

      <div id="top"></div>

      
        

          <div id="ng-stache" ng-controller="NavController"  class="bb-navbar">
            <bb-navbar>
              <div class="container">
                <div class="row">
                  <div class="col-sm-12">
                    <ul class="nav navbar-nav navbar-left">
  <li>
    <a href="https://developer.sky.blackbaud.com/">
      Home
    </a>
  </li>
  <li class="dropdown">
    <a href="/docs/getting-started/" class="dropdown-toggle">
      Documentation
      <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="/docs/getting-started/">Getting Started</a>
      </li>
      <li>
        <a href="/docs/authorization/">Authorization</a>
      </li>
      <li>
        <a href="/docs/apps/">Managing your apps</a>
      </li>
      <li>
        <a href="/docs/basics/">Basics</a>
      </li>
      <li>
       <a href="/docs/code/">Code Samples</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a href="https://developer.sky.blackbaud.com/docs/services/" class="dropdown-toggle">
      API
      <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="https://developer.sky.blackbaud.com/docs/services/">Endpoint Reference</a>
      </li>
      <li>
        <a href="/api/entity-reference/">Entity Reference</a>
      </li>
      <li>
        <a href="https://developer.sky.blackbaud.com/products/">Products</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a href="https://developer.sky.blackbaud.com/developer/" class="dropdown-toggle">
      Developer Account
      <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="https://developer.sky.blackbaud.com/developer/">My Profile</a>
      </li>
      <li>
        <a href="">My Applications</a>
      </li>
      <li>
        <a href="https://developer.sky.blackbaud.com/developer/analytics/">Analytics</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a href="/support/changelog/" class="dropdown-toggle">
      Support
      <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
       <li>
        <a href="https://community.blackbaud.com/developer">Community</a>
      </li>  
      <li>
        <a href="/support/changelog/">Changelog</a>
      </li>
       <li>
        <a href="/support/issues/">Issues</a>
      </li>
      <li>
        <a href="/support/ideas/">Ideas</a>
      </li>
      <li>
        <a href="/support/faq/">FAQ</a>
      </li>
      <li>
        <a href="https://skyapi.statuspage.io">Status</a>
      </li>
    </ul>
  </li>
</ul>
                    
                    
                  </div>
                </div>
              </div>
            </bb-navbar>
          </div>

        
      

      

      
      
        
    <div id="wrap-breadcrumbs">
        <div class="container">
            <ul class="breadcrumb">
                
                    
                        <li><a href="/">Home</a></li>
                    
                
                    
                        <li><a href="/docs/">Documentation</a></li>
                    
                
                    
                        <li><a href="/docs/code/">Code Samples</a></li>
                    
                
                    
                        <li><a href="/docs/code/auth-code-flow/">Authorization Code Flow</a></li>
                    
                
                    
                        <li class="active">C# .NET Core</li>
                    
                
            </ul>
        </div>
    </div>

      

      
        
          

<div class="content">
  <div class="container">
    <div class="row">
      <div class="col-sm-12">
        
          
<!-- STACHE MARKED -->
<div class="pull-right partial-edit-header">
    <a href="#disqus_thread" target="_self" class="edit-link btn btn-primary">
        Comments
    </a>
</div><div class="pull-right partial-edit-header">
    <a href="https://github.com/blackbaud/sky-api-docs/blob/develop/content/docs/code/auth-code-flow/c-sharp/index.md" target="_blank" class="edit-link btn btn-primary" rel="noopener noreferrer">
        <i class="fa fa-pencil"></i> Edit in GitHub
    </a>
</div>

<h1 id="authorization-code-flow-c-35-net-core">Authorization Code Flow - C# .NET Core</h1>
<p><a class="btn btn-primary" href="https://github.com/blackbaud/sky-api-tutorial-auth-code-c-sharp/" target="_blank" rel="noopener noreferrer"><i class="fa fa-github fa-lg"></i> GitHub</a>
<a class="btn btn-default" href="https://dotnetauthcode.azurewebsites.net/" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-globe"></i> Live Demo</a></p>
<h2 id="overview">Overview</h2>
<p>We use OAuth 2.0 to secure access to a user&apos;s SKY API data. In this tutorial we obtain user authorization using the <a href="/docs/authorization/auth-code-flow/">Authorization Code Flow</a>. From the user&apos;s perspective, the user authenticates as a Blackbaud user with the normal credentials for Blackbaud NXT and then authorizes (or denies) your application. To accomplish this, your application obtains an authorization code from the Blackbaud Authorization Service. The authorization code is then exchanged for an access token that signs requests to the SKY API on behalf of the user. The exchange involves your registered application&apos;s <strong>Application secret</strong>. For security reasons, the exchange is done through direct server-to-server communication. For this reason, we use <a href="https://blogs.msdn.microsoft.com/webdev/2016/05/16/announcing-asp-net-core-rc2/">ASP.NET Core</a> for the server-side platform and C#.</p>
<p>In this tutorial, we will accomplish the following tasks:</p>
<ul>
<li>Ensure that you signed up for a developer account and obtained your subscription to an API product.</li>
<li>Register an application with SKY API.</li>
<li>Obtain authorization to access user data for a specific tenant.</li>
<li>Retrieve data from a SKY API endpoint.</li>
</ul>
<p>For this tutorial, we strip down the user interface to highlight the Authorization Code Flow. Our <a href="/docs/code/">Barkbaud code sample</a> provides a rich user interface using <a href="http://skyux.developer.blackbaud.com/" target="blank">SKY UX</a>.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li>Since we are using the <a href="/docs/authorization/auth-code-flow/">Authorization Code Flow</a>, we need to use a server-side software platform, such as .NET Core. You will need to <a href="https://www.microsoft.com/net/core">Download and install</a> .NET Core</li>
<li>Familiarity using a command line interface (CLI) such as Terminal or Windows Command Prompt.</li>
<li>Sign up for a <a href="https://github.com">GitHub</a> account, if you don&apos;t already have one. The source code for this tutorial is stored in GitHub repository.</li>
<li>Install <a href="https://git-scm.com/">Git</a> and have the ability to clone or fork a repo.</li>
<li>A reliable Internet connection.</li>
</ol>
<h2 id="step-1-mdash-get-your-keys">Step 1 &#x2014; Get Your Keys</h2>
<p>If you have not already done so, complete the <a href="/docs/getting-started/">Getting Started guide</a>. The tutorial guides you through signing up for a Blackbaud developer account and requesting a subscription to an API product. After you are approved, your subscription contains a <strong>Primary key</strong> and <strong>Secondary key</strong>. You can use either key as the subscription key value for the <code>bb-api-subscription-key</code> request header in calls to the API.</p>
<h3 id="developer-sandbox-tenant">Developer Sandbox Tenant</h3>
<p>After your subscription is approved, your developer account can access the Developer Sandbox tenant that represents a sample database. With this particular tenant, keep in mind that you share this sandbox with other developers. You can access the Developer Sandbox tenant and learn the various endpoints through the interactive SKY API Console within the <a href="https://developer.sky.blackbaud.com/docs/services/" target="_blank" rel="noopener noreferrer">API Reference</a>.</p>
<h2 id="step-2-mdash-register-your-app">Step 2 &#x2014; Register Your App</h2>
<p>To register your application:</p>

<ol>
<li><p>Go to <a href="" target="_blank" rel="noopener noreferrer">My Applications</a> to manage your applications.</p>
</li>
<li><p>Click <strong>Register app</strong>.
<img src="/assets/img/my_applications.png" alt="My Applications" title="My Applications"></p>
</li>
<li><p>Enter the following information:
<div class="table-responsive">
 <table class="table table-striped table-hover">
   <thead>
     <tr>
       <th>Field</th>
       <th>Description</th>
     </tr>
   </thead>
   <tbody>
     <tr>
       <td>Application name</td>
       <td>(Required) Enter a name for your application. This is the name that users will see when asked to grant access to your application during the <a href="/docs/authorization/" target="_blank" rel="noopener noreferrer">authorization process</a>.  It will also be seen by administrators within the Applications area of the product when they view the list of applications that have been granted access to their data.</td>
     </tr>
     <tr>
       <td>Application details</td>
       <td>(Required) Provide a description for your application.  This will be seen by administrators when activating your application within the product.</td>
     </tr>
     <tr>
       <td>Organization name</td>
       <td>(Required) Specify the company name that users and administrators will see associated with your application.</td>
     </tr>
     <tr>
       <td>Application logo</td>
       <td>(Optional) Provide a 512 by 512 pixel PNG or JPEG image that users and administrators will see associated with your application.</td>
     </tr>
     <tr>
       <td class="nowrap">Application website URL</td>
       <td>(Required) Enter a URL where users can find out more information about your application.</td>
     </tr>
     <tr>
       <td>Redirect URIs</td>
       <td>(Required) Specify one or more URIs that should be used when redirecting the user&apos;s browser back to your application after providing consent during the <a href="/docs/authorization/" target="_blank" rel="noopener noreferrer">authorization process</a>.  The URIs must be absolute and use https (note that we do support <code>http://localhost:port</code> or <code>http://127.0.0.1:port</code> for local development). To register multiple URIs, click <strong>Add another redirect URI</strong>.
             <br><br>For this tutorial, use <code>http://localhost:5000/auth/callback</code>.</td>
     </tr>
   </tbody>
 </table>
</div></p>
<p class="alert alert-warning"><strong>Important!&#xA0;&#xA0;</strong> When your application requests authorization to access a Blackbaud customer&apos;s data, it will include a <code>redirect_uri</code> parameter as part of the query string.  This value must match <i>exactly</i> against one of the values you listed when registering your application, including any trailing slashes.  If the value supplied does not match any of the registered redirect URIs, then authorization will fail.  For more information on commonly encountered authorization problems, see <a href="/docs/authorization/common-auth-issues" target="_blank" rel="noopener noreferrer">common authorization issues</a>.</p>
<p><img src="/assets/img/add_app_top.png" alt="Basic Info" title="Basic Info"></p>
</li>
<li><p>Click <strong>Save</strong> to complete the registration of your application.</p>
</li>
<li><p>After you register an application, take note of the credentials (<strong>ID</strong> and <strong>Secret</strong>) that are displayed in the <strong>Application Credentials</strong> column.  These credentials are unique to your application, and are used to verify your application&apos;s identity during the <a href="/docs/authorization/" target="_blank" rel="noopener noreferrer">authorization process</a>.</p>
<ul>
<li><strong>Application ID</strong> is the unique identifier for your application.  This value is not sensitive and can be shared publicly.  It cannot be modified after the application is registered, so if you need change it for any reason you must delete the application and re-add it.</li>
<li><p><strong>Application secret</strong> is the key your application will provide when requesting an access token to call the SKY API as part of the <a href="/docs/authorization/" target="_blank" rel="noopener noreferrer">authorization process</a>. This value is sensitive and should <strong>NOT</strong> be shared with anyone else! To display the secret, click <strong>Show</strong> in the <strong>Application Credentials</strong> column.</p>
  <p class="alert alert-warning"><strong><em>Very Important!&#xA0;&#xA0;</em></strong> The application secret should be kept private and safe! <a href="/docs/apps/#regenerate-your-secret">Regenerate your secret</a> if it is compromised. Blackbaud reserves the right to remove or deactivate your application in order to protect our customer&apos;s data.</p>

<p><img src="/assets/img/my_applications2.png" alt="Your registered applications list" title="Your registered applications list"></p>


</li>
</ul>
</li>
</ol>
<h2 id="step-3-mdash-grab-the-source-code">Step 3 &#x2014; Grab the Source Code</h2>
<p>The <a href="https://github.com/blackbaud/sky-api-tutorial-auth-code-c-sharp/" target="_blank" rel="noopener noreferrer">sky-api-auth-tutorial-c-sharp</a> repo on GitHub provides a starter project to work through the Authorization Code Flow.</p>
<ul>
<li><p>Use a command prompt to clone the <code>sky-api-auth-tutorial-c-sharp</code> repo which creates a working directory by the same name that contains the code for the tutorial:</p>
  <pre><code class="language-git">$ git clone https://github.com/blackbaud/sky-api-auth-tutorial-c-sharp.git</code></pre>

</li>
</ul>
<h2 id="step-4-mdash-prepare-your-environment">Step 4 &#x2014; Prepare Your Environment</h2>
<p>Let&apos;s explore some application settings files and prep your environment variables.</p>
<ul>
<li>Open the <strong>sky-api-auth-tutorial-c-sharp</strong> working directory.</li>
<li><p>Open the <strong>appsettings.json</strong> which details generic properties to be used by the application. Take note of the following SKY API URI property values:</p>
  <div class="table-responsive">
          <table class="table table-striped table-condensed">
              <tr>
                  <td><strong><code>AuthBaseUri</code></strong></td>
                  <td>URI to the Authorization Service.</td>
              </tr>
              <tr>
                  <td><strong><code>SkyApiBaseUri</code></strong></td>
                  <td>URI to the SKY API Endpoints.</td>
              </tr>
          </table>
      </div>
</li>
<li><p>For local development, duplicate the file <strong>appsettings.json-sample</strong>, renaming it to <strong>appsettings.Development.json</strong>.   The <strong>appsettings.Development.json</strong> file contains your registered application&apos;s environment variables.  Note that private properties, such as your <strong>Application ID</strong> and <strong>Application secret</strong>, are stored in this file. For security, the <strong>appsettings.Development.json</strong> is excluded from being syncronized with GitHub via the file  <a href="https://github.com/blackbaud/sky-api-auth-tutorial-c-sharp/blob/master/.gitignore" target="_blank" rel="noopener noreferrer"><strong>.gitignore</strong></a>.</p>
<p>  At run time, the application will merge these properties into the available environment variables.   In .NET Core, the Startup class, <strong>Startup.cs</strong> provides the entry point for an application, and is required for all applications. This class configures the application and sets up the required middleware.</p>
  <pre><code class="language-json">{
  &quot;AppSettings&quot;: {
      &quot;AuthClientId&quot;: &quot;&quot;,
      &quot;AuthClientSecret&quot;: &quot;&quot;,
      &quot;AuthRedirectUri&quot;: &quot;http://localhost:5000/auth/callback&quot;,
      &quot;AuthSubscriptionKey&quot;: &quot;&quot;
  }
}</code></pre>
</li>
<li><p>Using the values from your registered application and the subscription key from your Blackbaud Developer Profile, update <strong>appsettings.Development.json</strong> with the following values.  All values are required.:</p>
  <div class="table-responsive">
  <table class="table table-striped table-condensed">
          <tr>
          <td><strong><code>AuthClientId</code></strong></td>
      <td>
        Your registered application&apos;s <strong>Application ID</strong>.
      </td>
          </tr>
    <tr>
      <td><strong><code>AuthClientSecret</code></strong></td>
      <td>
        Your registered application&apos;s <strong>Application secret</strong>.
      </td>
    </tr>
    <tr>
      <td><strong><code>AuthRedirectUri</code></strong></td>
      <td>
        One of your registered application&apos;s <strong>Redirect URIs</strong>.<br>
        For this tutorial, we will use <code>http://localhost:5000/auth/callback</code>.
      </td>
    </tr>
    <tr>
      <td><strong><code>AuthSubscriptionKey</code></strong></td>
      <td>
        Your Blackbaud Developer <strong>Subscription Key</strong>.<br>
                  Use either the <strong>Primary key</strong> or <strong>Secondary key</strong>, visible on your <a href="https://developer.sky.blackbaud.com/developer" target="_blank" rel="noopener noreferrer">Blackbaud Developer Profile</a>.
      </td>
    </tr>
  </table>
</div>
</li>
<li><p>Save the file.</p>
</li>
</ul>
<h2 id="step-5-mdash-run-the-application">Step 5 &#x2014; Run the Application</h2>
<ul>
<li>Using Command Prompt/Terminal/bash prompt, ensure you are in the working directory.</li>
<li>Open and review the <strong>project.json</strong> file.  This file details the application&#x2019;s dependencies. These NuGet modules (project dependencies) are installed when issuing the  <code>dotnet restore</code> command within Command Prompt/Terminal/bash prompt.</li>
<li><p>On a Mac, issue the following commands to restore the packages specified in the <strong>project.json</strong> file and run the actual sample:</p>
<pre><code>$  dotnet restore
$  export ASPNETCORE_ENVIRONMENT=Development &amp;&amp; dotnet run
</code></pre><p>  On a PC, type:</p>
<pre><code>$  dotnet restore
$  set ASPNETCORE_ENVIRONMENT=Development &amp;&amp; dotnet run
</code></pre></li>
<li><p>Visit <a href="http://localhost:5000/">http://localhost:5000/</a> to view your locally running application.</p>
</li>
</ul>
<h2 id="application-starting-point">Application Starting Point</h2>
<ul>
<li>IIS is used as the webserver.  An ASP.NET Core Module configured in <strong>project.json</strong> is used to list dependencies and configure IIS to launch and host your application.</li>
<li>Open the <strong>Program.cs</strong> file. The <code>Main()</code> method is the starting point of our application. It is responsible for initializing the application. We use <code>WebHostBuilder</code> to listen on a particular IP address and port:  <code>http://localhost:5000/</code>. As of RC2 an ASP.NET Core application is a .NET Core Console application that calls into ASP.NET specific libraries.  This code runs on the server-side and is <em>not</em> visible to the application user. Running the code server-side helps to protect your <strong>Application secret</strong>.</li>
<li><pre><code class="language-csharp">using System.IO;
using Microsoft.AspNetCore.Hosting;

namespace Blackbaud.AuthCodeFlowTutorial
{
    public class Program
    {
        public static void Main(string[] args)
        {
            var host = new WebHostBuilder()
                .UseKestrel()
                .UseContentRoot(Directory.GetCurrentDirectory())
                .UseIISIntegration()
                .UseStartup<startup>()
                .Build();
            host.Run();
        }
    }
}</startup></code></pre></li>
<li><p>Open your browser to <a href="http://localhost:5000/" target="http://localhost:5000/">http://localhost:5000/</a> to request the Home page. When the front page loads, the AngularJS on the Home page (<strong>/Views/Shared/_Layout.cshtml</strong>) makes a request to the <code>/auth/authenticated</code> endpoint:</p>
<pre><code class="language-javascript">(function (angular) {
  &apos;use strict&apos;;

  angular.module(&apos;AuthCodeFlowTutorial&apos;, [])
    .controller(&apos;ConstituentCtrl&apos;, function ($scope, $http) {

      // Check user access token.
      $http.get(&apos;/auth/authenticated&apos;).then(function (res) {
        $scope.isAuthenticated = res.data.authenticated;
        if ($scope.isAuthenticated === false) {
          $scope.isReady = true;
          return;
        }
    ...</code></pre>
<p>The call to the endpoint routes to the corresponding controller (<strong>/Controllers/AuthenticationController.cs</strong>) and returns a Boolean representing the current user&apos;s authentication status.  If the application has not yet been authorized by the end user, then <code>IsAuthenticated()</code> will return <code>false</code>.</p>
<pre><code class="language-csharp">[HttpGet(&quot;authenticated&quot;)]
public ActionResult Authenticated()
{
    return Json(new {
        authenticated = _authService.IsAuthenticated()
    });
}
...</code></pre>
</li>
</ul>

<h2 id="displaying-the-log-in-button">Displaying the Log in button</h2>
<ul>
<li><p>If the user is not authenticated, a <strong>Log in</strong> button is displayed.</p>
<p class="alert alert-info"><strong><em>Note:</em></strong> The browser may display a warning that the connection is not private. For this tutorial, you can ignore this message. To proceed, click <strong>Show advanced</strong> and then click <strong>Proceed to localhost (unsafe)</strong>.</p>
<img src="/assets/img/auth_tutorial_login_c_sharp.png" alt="Login" title="Log in"></li>
<li><p>Open the <strong>Views/Shared/_Layout.cshtml</strong> file. Notice that the <code>body</code> tag includes an attribute named <code>ng-app</code>. The front-end of our application uses AngularJS to interact with our Web server routes. The <code>div.container</code> element includes an attribute named <code>ng-controller</code> which references an AngularJS controller to handle the model data.</p>
<pre><code class="language-markup">&lt;body ng-app=&quot;AuthCodeFlowTutorial&quot;&gt;
  &lt;div class=&quot;container&quot; ng-controller=&quot;ConstituentCtrl&quot; ng-cloak&gt;
    ...</code></pre></li>
<li><p>When the Home page first loads the app will not have received authorization from the user to access their SKY API data. As a result the <code>isAuthenticated</code> scope variable will be <code>false</code> and the Home page&apos;s Angular HTML template displays the <strong>Log in</strong> button:</p>
<pre><code class="language-markup">&lt;div ng-if=&quot;!isAuthenticated&quot;&gt;
    &lt;a href=&quot;/auth/login&quot; class=&quot;btn btn-primary&quot;&gt;Log in&lt;/a&gt;
&lt;/div&gt;
...</code></pre></li>
</ul>

<h2 id="obtain-an-access-token">Obtain an Access Token</h2>
<ul>
<li>Open <strong>/Controllers/AuthenticationController.cs</strong>.</li>
<li><p>When the user clicks the <strong>Log in</strong> button, a call is made to <code>LogIn()</code> which redirects the browser to SKY API&#x2019;s authorization endpoint to start the authentication and authorization process.  The user must authenticate with their Blackbaud credentials (if they are not already signed in) and authorize your application to access their SKY API data.</p>
<pre><code class="language-csharp">[HttpGet(&quot;login&quot;)]
public ActionResult LogIn()
{
    Uri address = _authService.GetAuthorizationUri();
    return Redirect(address.ToString());
}
...</code></pre></li>
<li><p>Once authorized, SKY API redirects the user back to the <code>/auth/callback</code> URI with an authorization code. Once an authorization code has been obtained, it is exchanged the code for an access token.  The app is then redirected back to the Home page.</p>
<pre><code class="language-csharp"> [HttpGet(&quot;callback&quot;)]
public ActionResult Callback()
{
    string code = Request.Query[&quot;code&quot;];
    _authService.ExchangeCodeForAccessToken(code);
    return Redirect(&quot;/&quot;);
}
...</code></pre></li>
</ul>

<h2 id="retrieve-constituent-data">Retrieve Constituent Data</h2>
<ul>
<li>Open the Home page (<strong>Views/Shared/_Layout.cshtml</strong>).</li>
<li><p>AngularJS again makes the request to <code>auth/authenticated</code>, which now returns <code>true</code>. Since the user is authorized, AngularJS then makes a request the application&#x2019;s constituent API endpoint <code>/api/constituents/280</code> to retrieve a constituent record:</p>
<pre><code class="language-javascript">angular.module(&apos;AuthCodeFlowTutorial&apos;, [])
    .controller(&apos;ConstituentCtrl&apos;, function ($scope, $http) {

        // Check user access token.
        $http.get(&apos;/auth/authenticated&apos;).then(function (res) {
            $scope.isAuthenticated = res.data.authenticated;
            if ($scope.isAuthenticated === false) {
                $scope.isReady = true;
                return;
            }

            // Access token is valid. Fetch constituent record.
            $http.get(&apos;/api/constituents/280&apos;).then(function (res) {
                $scope.constituent = res.data;
                $scope.isReady = true;
            });
        });
    ...</code></pre>
</li>
<li><p>The data is returned as JSON to the Home page where the model&apos;s data is projected through the view of the HTML template:</p>
<pre><code class="language-markup" ng-non-bindable="">&lt;div ng-if=&quot;isAuthenticated&quot;&gt;
  &lt;h3&gt;Constituent: &lt;/h3&gt;
  &lt;p&gt;
    See &lt;a href=&quot;/api/entity-reference/constituent&quot;&gt;Constituent&lt;/a&gt;
    within the SKY API entity reference for a full listing of properties.
  &lt;/p&gt;
  &lt;p ng-if=&quot;::constituent.error&quot; ng-bind=&quot;::constituent.error&quot; class=&quot;alert alert-danger&quot;&gt;&lt;/p&gt;
  &lt;div ng-if=&quot;::constituent.id&quot; class=&quot;table-responsive&quot;&gt;
    &lt;table class=&quot;table table-striped table-hover&quot;&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;Name&lt;/th&gt;
          &lt;th&gt;Value&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td&gt;id&lt;/td&gt;
          &lt;td&gt;{{ constituent.id }}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;type&lt;/td&gt;
          &lt;td&gt;{{ constituent.type }}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;lookup_id&lt;/td&gt;
          &lt;td&gt;{{ constituent.lookup_id }}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;first&lt;/td&gt;
          &lt;td&gt;{{ constituent.first }}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;last&lt;/td&gt;
          &lt;td&gt;{{ constituent.last }}&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/div&gt;
...</code></pre>
<img src="/assets/img/auth_tutorial_GETConstituent_c_sharp.png" alt="GET Constituent" title="GET Constituent">
</li>
<li>Once the constituent information is retrieved and added to the front page, <strong>Log Out</strong> and <strong>Refresh Access Token</strong> buttons are displayed.</li>
<li>Open <strong>/Controllers/AuthenticationController.cs</strong></li>
<li>If the user clicks <strong>Log Out</strong>, they are redirected to <code>/auth/logout</code> which destroys the access/refresh token stored in the browser&#x2019;s session.</li>
<li>If the user clicks <strong>Refresh Access Token</strong>, AngularJS makes a request to <code>/auth/refresh-token</code>, which asks SKY API to return a refreshed access token, which is then stored in the browser&#x2019;s session.</li>
</ul>

<p>That&apos;s it!</p>
<ul>
<li>Be sure to take a look at our other <a href="/docs/code/">code samples</a>.</li>
<li>Check out the <a href="https://github.com/blackbaud/sky-api-tutorial-auth-code-c-sharp//blob/master/README.md">README</a> where you can view a live demo of the application hosted on Microsoft Azure.</li>
<li>The README also contains instructions for deploying to Azure App Services rather than your local development environment.</li>
<li>You can <a href="https://github.com/blackbaud/sky-api-tutorial-auth-code-c-sharp/issues">create an issue</a> to report a bug or request a feature for this code sample.  For all other feature requests, see <a href="/support/ideas/">ideas</a>.</li>
</ul>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//sky-api.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
</div>
        
      </div>
    </div>
  </div>
</div>

        
      

      

      
        <div class="back-to-top" data-offset="220">
  <i class="fa fa-angle-double-up"></i>
</div>
      

      <div class="affix-stop">
        

        
          

            <div class="footer-site">
              <div class="container">
                <div class="row">
                  <div class="col-xs-6 col-sm-4">
                    <h3>
  <a href="https://developer.sky.blackbaud.com/">
    SKY API
  </a>
</h3>
                    <ul class="nav navbar-nav navbar-left">
  <li>
    <a href="https://developer.sky.blackbaud.com/">
      Home
    </a>
  </li>
  <li class="dropdown">
    <a href="/docs/getting-started/">
      Documentation
      <span class="caret"></span>
    </a>
  </li>
  <li class="dropdown">
    <a href="https://developer.sky.blackbaud.com/docs/services/">
      API
      <span class="caret"></span>
    </a>
  </li>
  <li class="dropdown">
    <a href="https://developer.sky.blackbaud.com/developer/">
      Developer Account
      <span class="caret"></span>
    </a>
  </li>
  <li class="dropdown">
    <a href="/support/changelog/">
      Support
      <span class="caret"></span>
    </a>
  </li>
  <li class="terms">
    <a href="https://developer.sky.blackbaud.com/terms">
      API Terms of Use
    </a>
  </li>
</ul>
                  </div>
                  <div class="col-xs-6 col-sm-4 col-sm-push-4">
                    <ul class="list-inline social-icons">
  <li>
    <a href="http://twitter.com/blackbaud" target="_blank">
      <i class="fa fa-twitter"></i>
    </a>
  </li>
  <li>
    <a href="https://www.facebook.com/blackbaud" target="_blank">
      <i class="fa fa-facebook"></i>
    </a>
  </li>
  <li>
    <a href="http://www.youtube.com/user/blackbaudinc" target="_blank">
      <i class="fa fa-youtube"></i>
    </a>
  </li>
</ul>
                  </div>
                  <div class="clearfix visible-xs-block"></div>
                  <div class="col-sm-4 col-sm-pull-4">
                    
                  </div>
                </div>
              </div>
            </div>

          
        

        
          
            <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <p>&copy; 2016 Blackbaud, Inc. All rights reserved.</p>
            </div>
        </div>
    </div>
</div>
          
        
      </div>

      
        <bb-omnibar></bb-omnibar>
<bb-omnibar-search-results></bb-omnibar-search-results>
      

      
        <script src="https://sky.blackbaudcdn.net/skyux/1.9.2/js/sky-bundle.min.js"></script>
      

      

      <script src="/js/stache.min.js"></script>

      
        
      
        
      

      
        
          <script src="/assets/js/scrollreveal.js"></script>
        
      
        
          <script src="/assets/js/custom.js"></script>
        
      

      

      

      
        
          <script>
            !function(e,a){"use strict";function n(){var e={};try{e.omnibar={enableHelp:!1,enableSearch:!0,serviceName:"SKY API",serviceNameLink:"https://developer.sky.blackbaud.com/",enableServiceNameLink:!0,url:"https://signin.blackbaud.com/omnibar.min.js",urlDev:"https://bbauth-signin-cdev.blackbaudhosting.com/omnibar.min.js",delegationUri:"https://developer.sky.blackbaud.com/signin/"},e.omnibarSearch={resultsBaseUri:"",resourceUrl:"/content.json",resultsTemplateUri:"/assets/vendor/bb-omnibar-search/templates/bb-omnibar-search.hbs",searchFormClass:"searchenabled",searchFormClassDev:"bb-omnibar-searchenabled",searchInputId:"omnibar_searchbox",searchResultsId:"bb-omnibar-search-results"}}catch(e){}return e}function t(e,a){e.$on("bbBeginWait",function(e,n){e.stopPropagation(),a.beginPageWait(n)}),e.$on("bbEndWait",function(e,n){e.stopPropagation(),a.endPageWait(n)})}t.$inject=["$rootScope","bbWait"],a.module("stache").constant("stacheConfig",n.call()).run(t),a.element(document).ready(function(){a.bootstrap(document,["stache"])})}(window,window.angular);
          </script>
        
      

      

    </body>
  </html>

