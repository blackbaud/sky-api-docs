!function(a){"use strict";function b(a){return function(b,c){return c&&b&&(b=b.replace(new RegExp("("+h(c)+")","gi"),'<span class="highlighted">$1</span>')),a.trustAsHtml(b)}}function c(b,c,d,e,f){function g(){e.fetchPages().then(function(a){a.error?(q.enabled=!1,i()):(q.enabled=!0,c(function(){h(),j()}))})}function h(){a.element(document).on("click",function(a){q.query&&!p.is(a.target)&&0===p.has(a.target).length&&l()}).on("keyup",function(a){switch(a.keyCode){case 27:q.query&&l();break;case 191:break;default:k()}})}function i(){a.element(document.getElementsByClassName(f.getSearchFormClass())).removeClass(f.getSearchFormClass()),d.enableSearch=!1}function j(){p=a.element(document.getElementById(f.getSearchResultsId())),o=a.element(document.getElementById(f.getSearchInputId())),k(),a.element(window).bind("resize",function(){k()})}function k(){p.css({left:o.position().left+"px"})}function l(){q.query=n.searchText="",q.searching=n.searching=!1,q.results=[],b.$digest()}function m(){return q.searching=n.searching=!0,q.query=n.searchText,""===q.query||q.enabled===!1?void l():void e.search(q.query).then(function(a){return a.error?(i(),void l()):(q.results=a,void(q.searching=n.searching=!1))})}var n,o,p,q;n=b.$parent,q=this,q.messages={searching:q.searchingMessage||b.searchingMessage||"Searching...",noResults:q.noResultsMessage||b.noResultsMessage||"Unable to locate any results."},q.searching=!1,q.enabled=!1,q.query="",n.$on("searchBoxKeyUp",m),b.$on("omnibarSearchLoaded",g)}function d(b,c,d){c.afterLoad=function(){a.element(document).ready(function(){b.$broadcast("omnibarSearchLoaded")})}}function e(b,c,d){function e(c){function d(b){var c,d,e,g;if(g=[],!a.isArray(b))return g;for(c=0,d=b.length;c<d;c++)e=b[c],e=f(e),e.weight>0&&g.push(e);return g}function e(a){return a.sort(function(a,b){return a.weight>b.weight?1:a.weight<b.weight?-1:0}),a}function f(a){var b,c;return b=[{type:"description",baseWeight:100,include:!0},{type:"name",baseWeight:1e3,include:!1},{type:"text",baseWeight:1,include:!0}],c=new RegExp(h(k.keywords),"ig"),a.weight=0,a.match="",b.forEach(function(b){var d,e,f;if(a[b.type]){for(d=a[b.type],d=d.replace(/\n/g," ");null!==(f=c.exec(d));)a.weight+=b.baseWeight,b.include&&(e=f);!function(b){var c,e,f,g;return void 0===b?void(a.weight=0):(g=b.index-10,g<0&&(g=0),e=b.index+50,e>d.length-1&&(e=d.length-1),f=d.slice(g,b.index),c=d.slice(b.index,e),g>0&&(f="..."+f.substr(2).replace(/^ /,"")),void(a.match=(f+c).trim()))}(e)}}),a}var g,i,k;g={keywords:""},i="",k=a.extend({},g,c),this.execute=function(){var a=b.defer();return j.fetchPages().then(function(b){return b.error?void a.resolve(b):(i=d(b),i=e(i),void a.resolve(i))}),a.promise}}function f(){var a,b,c;for(a=0,b=i.length;a<b;a++)c=i[a],c.uri=g+c.uri}var g,i,j,k;j=this,g=d.getResultsBaseUri(),k=d.getResourceUrl(),this.search=function(a){var b=new e({keywords:a});return b.execute()},this.fetchPages=function(){var a=b.defer();return i?a.resolve(i):c.get(k,{cache:!1}).then(function(b){b.data&&b.data.hasOwnProperty("pages")?(i=b.data.pages,f(),j.status="success",a.resolve(i)):(j.status="error",a.resolve(b))})["catch"](function(b){j.status="error",a.resolve({error:b})}),a.promise}}function f(){var a,b,c,d,e,f;a="",b=a+"/content.json",c="bb-omnibar-searchenabled",d="omnibar_searchbox",e="bb-omnibar-search-results",f="/assets/vendor/bb-omnibar-search/templates/bb-omnibar-search.hbs",this.setResultsBaseUri=function(b){void 0!==b&&(a=b)},this.setResourceUrl=function(a){b=a},this.setSearchFormClass=function(a){c=a},this.setSearchInputId=function(a){d=a},this.setSearchResultsId=function(a){e=a},this.setSearchResultsTemplateUri=function(a){f=a},this.$get=function(){return{getResultsBaseUri:function(){return a},getResourceUrl:function(){return b},getSearchFormClass:function(){return c},getSearchInputId:function(){return d},getSearchResultsId:function(){return e},getSearchResultsTemplateUri:function(){return f}}}}function g(a){return{restrict:"AE",controller:"OmnibarSearchController",controllerAs:"ctrl",scope:{noResultsMessage:"@",searchingMessage:"@"},bindToController:!0,templateUrl:a.getSearchResultsTemplateUri()}}function h(a){return void 0===a||"string"!=typeof a?"":a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}b.$inject=["$sce"],c.$inject=["$scope","$timeout","bbOmnibarConfig","SearchService","OmnibarSearchSettings"],d.$inject=["$rootScope","bbOmnibarConfig","OmnibarSearchSettings"],e.$inject=["$q","$http","OmnibarSearchSettings"],g.$inject=["OmnibarSearchSettings"],a.module("OmnibarSearch",["sky"]).controller("OmnibarSearchController",c).directive("bbOmnibarSearchResults",g).filter("highlight",b).provider("OmnibarSearchSettings",f).service("SearchService",e).run(d)}(window.angular),function(a){"use strict";a.module("OmnibarSearch.templates",[]).run(["$templateCache",function(a){a.put("/assets/vendor/bb-omnibar-search/templates/bb-omnibar-search.hbs",['<div id="bb-omnibar-search-results" ng-if="ctrl.enabled" ng-show="ctrl.query" ng-cloak>','  <p ng-show="ctrl.searching">{{ ctrl.messages.searching }}</p>','  <p ng-show="!ctrl.searching && !ctrl.results.length">{{ ctrl.messages.noResults }}</p>','  <ul class="list-unstyled" ng-show="ctrl.results.length">',"    <li ng-repeat=\"result in ctrl.results | orderBy:'-weight' | limitTo: '8'\">",'      <a ng-href="{{ result.uri }}"><strong>{{ result.name }}</strong>','      <div class="bb-omnibar-search-result-description" ng-bind-html="result.match | limitTo: 60 | highlight:ctrl.query"></div></a>',"    </li>","  </ul>","</div>"].join(""))}])}(window.angular);